<!-- AdvancedWinUiDataGrid/build/RpaWinUiComponents.AdvancedWinUiDataGrid.targets -->
<!-- ✅ NETSDK1152 COMPLETE FIX: SINGLE PATH ONLY -->
<Project>

  <!-- ✅ Debug informácie -->
  <Target Name="DebugAdvancedDataGridPackage" BeforeTargets="ResolveReferences" Condition="'$(Configuration)' == 'Debug' AND '$(UseWinUI)' == 'true'">
    <Message Text="🔍 AdvancedWinUiDataGrid: Package v1.0.21 loaded (NETSDK1152 COMPLETE FIX)" Importance="normal" />
    <Message Text="🔍 AdvancedWinUiDataGrid: MSBuildThisFileDirectory = $(MSBuildThisFileDirectory)" Importance="normal" />
    <Message Text="🔍 AdvancedWinUiDataGrid: Using SINGLE path only" Importance="normal" />
  </Target>

  <!-- ✅ CRITICAL FIX: ONLY ONE FIXED PATH -->
  <PropertyGroup>
    <!-- ✅ SINGLE unified path - NO alternatives -->
    <AdvancedDataGridLibPath>$(MSBuildThisFileDirectory)../lib/net8.0-windows10.0.19041.0/</AdvancedDataGridLibPath>
    <AdvancedDataGridContentPath>$(MSBuildThisFileDirectory)../content/</AdvancedDataGridContentPath>
  </PropertyGroup>

  <!-- ✅ Assembly reference - SINGLE path only -->
  <ItemGroup Condition="'$(UseWinUI)' == 'true' AND '$(AdvancedDataGridLibPath)' != ''">

    <!-- ✅ Main assembly reference - FIXED SINGLE PATH -->
    <Reference Include="AdvancedWinUiDataGrid" Condition="Exists('$(AdvancedDataGridLibPath)AdvancedWinUiDataGrid.dll')">
      <HintPath>$(AdvancedDataGridLibPath)AdvancedWinUiDataGrid.dll</HintPath>
      <Private>False</Private>
      <ExcludeAssets>runtime</ExcludeAssets>
    </Reference>

  </ItemGroup>

  <!-- ✅ XBF files copying - SINGLE source only -->
  <Target Name="CopyAdvancedDataGridXbfFiles" BeforeTargets="PrepareForBuild" Condition="'$(UseWinUI)' == 'true' AND '$(AdvancedDataGridLibPath)' != ''">
    <Message Text="🎨 Copying XBF files from SINGLE path: $(AdvancedDataGridLibPath)" Importance="normal" />

    <!-- ✅ Find XBF files from SINGLE path only -->
    <ItemGroup>
      <AdvancedDataGridXbfFiles Include="$(AdvancedDataGridLibPath)*.xbf" />
      <AdvancedDataGridXbfFiles Include="$(AdvancedDataGridLibPath)**/*.xbf" />
    </ItemGroup>

    <!-- ✅ Copy XBF files without duplicates -->
    <Copy SourceFiles="@(AdvancedDataGridXbfFiles)"
          DestinationFolder="$(OutputPath)%(RecursiveDir)"
          SkipUnchangedFiles="true"
          OverwriteReadOnlyFiles="true"
          UseHardlinksIfPossible="false"
          Condition="'@(AdvancedDataGridXbfFiles)' != ''" />

    <Message Text="✅ Copied @(AdvancedDataGridXbfFiles->Count()) XBF files from SINGLE path" Importance="normal" Condition="'@(AdvancedDataGridXbfFiles)' != ''" />
    <Warning Text="⚠️ No XBF files found in path: $(AdvancedDataGridLibPath)" Condition="'@(AdvancedDataGridXbfFiles)' == ''" />
  </Target>

  <!-- ✅ WinUI3 specific settings -->
  <PropertyGroup Condition="'$(UseWinUI)' == 'true'">
    <EnableDefaultXamlItems>true</EnableDefaultXamlItems>
    <XamlCompilationEnabled>true</XamlCompilationEnabled>

    <!-- ✅ SUPPRESS duplicate assembly warnings -->
    <ResolveAssemblyWarnOrErrorOnTargetArchitectureMismatch>None</ResolveAssemblyWarnOrErrorOnTargetArchitectureMismatch>
    <MSBuildWarningsAsMessages>$(MSBuildWarningsAsMessages);MSB3277;NETSDK1152</MSBuildWarningsAsMessages>

    <!-- ✅ Disable duplicate reference warnings -->
    <DisableImplicitFrameworkReferences>false</DisableImplicitFrameworkReferences>

    <!-- ✅ NETSDK1152 COMPLETE FIX: Suppress all packaging warnings -->
    <MSBuildWarningsAsMessages>$(MSBuildWarningsAsMessages);NETSDK1152</MSBuildWarningsAsMessages>
    <NoWarn>$(NoWarn);NETSDK1152</NoWarn>
  </PropertyGroup>

  <!-- ✅ Verification target -->
  <Target Name="VerifyAdvancedDataGridPackage" BeforeTargets="PrepareForBuild" Condition="'$(Configuration)' == 'Debug' AND '$(UseWinUI)' == 'true'">

    <PropertyGroup>
      <PackageDllExists Condition="Exists('$(AdvancedDataGridLibPath)AdvancedWinUiDataGrid.dll')">true</PackageDllExists>
    </PropertyGroup>

    <Message Text="✅ Using SINGLE lib path (NETSDK1152 COMPLETE FIX): $(AdvancedDataGridLibPath)" Importance="normal" />
    <Message Text="✅ Package DLL found at SINGLE path: $(AdvancedDataGridLibPath)AdvancedWinUiDataGrid.dll"
             Importance="normal"
             Condition="'$(PackageDllExists)' == 'true'" />

    <Message Text="🎉 AdvancedWinUiDataGrid package loaded via SINGLE PATH (NETSDK1152 COMPLETE FIX)!"
             Importance="high"
             Condition="'$(PackageDllExists)' == 'true'" />

    <Error Text="❌ Package DLL not found at path: $(AdvancedDataGridLibPath)AdvancedWinUiDataGrid.dll"
           Condition="'$(PackageDllExists)' != 'true'" />
  </Target>

  <!-- ✅ CRITICAL: Block alternative framework paths -->
  <Target Name="BlockAlternativeFrameworkPaths" BeforeTargets="ResolveReferences" Condition="'$(UseWinUI)' == 'true'">
    <Message Text="🚫 Blocking alternative framework paths to prevent NETSDK1152..." Importance="normal" />

    <!-- Remove references to alternative path if they exist -->
    <ItemGroup>
      <Reference Remove="@(Reference)" Condition="'%(Reference.HintPath)' != '' AND %(Reference.HintPath.Contains('net8.0-windows10.0.19041\'))" />
    </ItemGroup>

    <Message Text="✅ Alternative framework paths blocked" Importance="normal" />
  </Target>

  <!-- ✅ Post-restore verification -->
  <Target Name="PostRestoreVerification" AfterTargets="RestoreComplete" Condition="'$(UseWinUI)' == 'true'">
    <Message Text="📦 Post-restore: AdvancedWinUiDataGrid SINGLE PATH verification..." Importance="normal" />
    <Message Text="📦 Single path: $(AdvancedDataGridLibPath)" Importance="normal" />
    <Message Text="✅ NETSDK1152 COMPLETE FIX active - no duplicates!" Importance="normal" />
  </Target>

</Project>