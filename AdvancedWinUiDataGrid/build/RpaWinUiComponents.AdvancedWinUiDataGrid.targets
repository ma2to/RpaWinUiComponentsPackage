<!-- AdvancedWinUiDataGrid/build/RpaWinUiComponents.AdvancedWinUiDataGrid.targets -->
<!-- ✅ OPRAVENÉ: MSBuild targets - NETSDK1152 fix -->
<Project>

  <!-- ✅ Debug informácie -->
  <Target Name="DebugAdvancedDataGridPackage" BeforeTargets="ResolveReferences" Condition="'$(Configuration)' == 'Debug' AND '$(UseWinUI)' == 'true'">
    <Message Text="🔍 AdvancedWinUiDataGrid: Package v1.0.16 loaded via NuGet (NETSDK1152 FIXED)" Importance="normal" />
    <Message Text="🔍 AdvancedWinUiDataGrid: MSBuildThisFileDirectory = $(MSBuildThisFileDirectory)" Importance="normal" />
    <Message Text="🔍 AdvancedWinUiDataGrid: TargetFramework = $(TargetFramework)" Importance="normal" />
  </Target>

  <!-- ✅ KĽÚČOVÁ OPRAVA: Unified package path logic - iba jeden path -->
  <PropertyGroup>
    <!-- ✅ Priorita 1: Presný match na TargetFramework -->
    <AdvancedDataGridLibPath Condition="'$(TargetFramework)' != '' AND Exists('$(MSBuildThisFileDirectory)../lib/$(TargetFramework)/')">$(MSBuildThisFileDirectory)../lib/$(TargetFramework)/</AdvancedDataGridLibPath>

    <!-- ✅ Priorita 2: Iba ak presný match neexistuje, skús dlhý formát -->
    <AdvancedDataGridLibPath Condition="'$(AdvancedDataGridLibPath)' == '' AND Exists('$(MSBuildThisFileDirectory)../lib/net8.0-windows10.0.19041.0/')">$(MSBuildThisFileDirectory)../lib/net8.0-windows10.0.19041.0/</AdvancedDataGridLibPath>

    <!-- ✅ ODSTRÁNENÉ: Všetky ostatné fallbacks aby sa zabránilo duplikátom -->

    <!-- ✅ Content path -->
    <AdvancedDataGridContentPath>$(MSBuildThisFileDirectory)../content/</AdvancedDataGridContentPath>
  </PropertyGroup>

  <!-- ✅ Assembly reference - iba ak DLL skutočne existuje a nie je duplicitná -->
  <ItemGroup Condition="'$(UseWinUI)' == 'true' AND '$(AdvancedDataGridLibPath)' != ''">

    <!-- ✅ Main assembly reference - CONDITIONAL aby sa zabránilo duplikátom -->
    <Reference Include="AdvancedWinUiDataGrid" Condition="Exists('$(AdvancedDataGridLibPath)AdvancedWinUiDataGrid.dll')">
      <HintPath>$(AdvancedDataGridLibPath)AdvancedWinUiDataGrid.dll</HintPath>
      <Private>False</Private>
      <ExcludeAssets>runtime</ExcludeAssets>
    </Reference>

  </ItemGroup>

  <!-- ✅ OPRAVENÉ: XBF súbory copying - iba z jedného zdroja -->
  <Target Name="CopyAdvancedDataGridXbfFiles" BeforeTargets="PrepareForBuild" Condition="'$(UseWinUI)' == 'true' AND '$(AdvancedDataGridLibPath)' != ''">
    <Message Text="🎨 Copying XBF files from single path: $(AdvancedDataGridLibPath)" Importance="normal" />

    <!-- ✅ Nájdi XBF súbory iba z jednej cesty -->
    <ItemGroup>
      <AdvancedDataGridXbfFiles Include="$(AdvancedDataGridLibPath)*.xbf" />
      <AdvancedDataGridXbfFiles Include="$(AdvancedDataGridLibPath)**/*.xbf" />
    </ItemGroup>

    <!-- ✅ Skopíruj XBF súbory bez duplikátov -->
    <Copy SourceFiles="@(AdvancedDataGridXbfFiles)"
          DestinationFolder="$(OutputPath)%(RecursiveDir)"
          SkipUnchangedFiles="true"
          OverwriteReadOnlyFiles="true"
          UseHardlinksIfPossible="false"
          Condition="'@(AdvancedDataGridXbfFiles)' != ''" />

    <Message Text="✅ Copied @(AdvancedDataGridXbfFiles->Count()) XBF files without duplicates" Importance="normal" Condition="'@(AdvancedDataGridXbfFiles)' != ''" />
    <Warning Text="⚠️ No XBF files found in: $(AdvancedDataGridLibPath)" Condition="'@(AdvancedDataGridXbfFiles)' == ''" />
  </Target>

  <!-- ✅ WinUI3 specific nastavenia -->
  <PropertyGroup Condition="'$(UseWinUI)' == 'true'">
    <EnableDefaultXamlItems>true</EnableDefaultXamlItems>
    <XamlCompilationEnabled>true</XamlCompilationEnabled>

    <!-- ✅ KĽÚČOVÁ OPRAVA: Potlač duplicate assembly warnings -->
    <ResolveAssemblyWarnOrErrorOnTargetArchitectureMismatch>None</ResolveAssemblyWarnOrErrorOnTargetArchitectureMismatch>
    <MSBuildWarningsAsMessages>$(MSBuildWarningsAsMessages);MSB3277</MSBuildWarningsAsMessages>

    <!-- ✅ Disable duplicate reference warnings -->
    <DisableImplicitFrameworkReferences>false</DisableImplicitFrameworkReferences>
  </PropertyGroup>

  <!-- ✅ Verification target -->
  <Target Name="VerifyAdvancedDataGridPackage" BeforeTargets="PrepareForBuild" Condition="'$(Configuration)' == 'Debug' AND '$(UseWinUI)' == 'true'">

    <PropertyGroup>
      <PackageDllExists Condition="Exists('$(AdvancedDataGridLibPath)AdvancedWinUiDataGrid.dll')">true</PackageDllExists>
    </PropertyGroup>

    <Message Text="✅ Using unified lib path: $(AdvancedDataGridLibPath)" Importance="normal" />
    <Message Text="✅ Package DLL found: $(AdvancedDataGridLibPath)AdvancedWinUiDataGrid.dll"
             Importance="normal"
             Condition="'$(PackageDllExists)' == 'true'" />

    <Message Text="🎉 AdvancedWinUiDataGrid package loaded via SINGLE PATH (NETSDK1152 FIXED)!"
             Importance="high"
             Condition="'$(PackageDllExists)' == 'true'" />

    <Error Text="❌ Package DLL not found at: $(AdvancedDataGridLibPath)AdvancedWinUiDataGrid.dll"
           Condition="'$(PackageDllExists)' != 'true'" />
  </Target>

</Project>