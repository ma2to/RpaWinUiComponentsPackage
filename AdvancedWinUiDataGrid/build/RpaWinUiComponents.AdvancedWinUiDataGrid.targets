<!-- AdvancedWinUiDataGrid/build/RpaWinUiComponents.AdvancedWinUiDataGrid.targets -->
<!-- ✅ KOMPLETNE OPRAVENÝ MSBuild targets pre správne Package Reference cesty -->
<Project>

  <!-- ✅ Debug informácie (iba v Debug mode) -->
  <Target Name="DebugAdvancedDataGridPackage" BeforeTargets="ResolveReferences" Condition="'$(Configuration)' == 'Debug' AND '$(UseWinUI)' == 'true'">
    <Message Text="🔍 AdvancedWinUiDataGrid: Package v1.0.2 loaded via NuGet" Importance="normal" />
    <Message Text="🔍 AdvancedWinUiDataGrid: MSBuildThisFileDirectory = $(MSBuildThisFileDirectory)" Importance="normal" />
    <Message Text="🔍 AdvancedWinUiDataGrid: TargetFramework = $(TargetFramework)" Importance="normal" />
  </Target>

  <!-- ✅ OPRAVENÉ: Správne package paths s fallback logikoul -->
  <PropertyGroup>
    <!-- Primárne cesty pre rôzne TFM konfigurácie -->
    <AdvancedDataGridLibPath Condition="Exists('$(MSBuildThisFileDirectory)../lib/$(TargetFramework)/')">$(MSBuildThisFileDirectory)../lib/$(TargetFramework)/</AdvancedDataGridLibPath>

    <!-- Fallback na špecifický TFM ak existuje -->
    <AdvancedDataGridLibPath Condition="'$(AdvancedDataGridLibPath)' == '' AND Exists('$(MSBuildThisFileDirectory)../lib/net8.0-windows10.0.19041.0/')">$(MSBuildThisFileDirectory)../lib/net8.0-windows10.0.19041.0/</AdvancedDataGridLibPath>

    <!-- Fallback na generic net8.0 -->
    <AdvancedDataGridLibPath Condition="'$(AdvancedDataGridLibPath)' == '' AND Exists('$(MSBuildThisFileDirectory)../lib/net8.0/')">$(MSBuildThisFileDirectory)../lib/net8.0/</AdvancedDataGridLibPath>

    <!-- Posledný fallback - pokúsi sa použiť default cestu -->
    <AdvancedDataGridLibPath Condition="'$(AdvancedDataGridLibPath)' == ''">$(MSBuildThisFileDirectory)../lib/net8.0-windows10.0.19041.0/</AdvancedDataGridLibPath>
  </PropertyGroup>

  <!-- ✅ OPRAVENÉ: Conditional reference len ak DLL skutočne existuje -->
  <ItemGroup Condition="'$(UseWinUI)' == 'true' AND Exists('$(AdvancedDataGridLibPath)RpaWinUiComponents.AdvancedWinUiDataGrid.dll')">
    <Reference Include="RpaWinUiComponents.AdvancedWinUiDataGrid">
      <HintPath>$(AdvancedDataGridLibPath)RpaWinUiComponents.AdvancedWinUiDataGrid.dll</HintPath>
      <Private>False</Private>
    </Reference>
  </ItemGroup>

  <!-- ✅ WinUI3 specific nastavenia -->
  <PropertyGroup Condition="'$(UseWinUI)' == 'true'">
    <EnableDefaultXamlItems>true</EnableDefaultXamlItems>
    <XamlCompilationEnabled>true</XamlCompilationEnabled>
    <XamlResourcesEnabled>true</XamlResourcesEnabled>
  </PropertyGroup>

  <!-- ✅ OPRAVENÉ: Debug target len ak je Debug config a DLL existuje -->
  <Target Name="VerifyAdvancedDataGridPackage" BeforeTargets="PrepareForBuild" Condition="'$(Configuration)' == 'Debug' AND '$(UseWinUI)' == 'true'">

    <PropertyGroup>
      <PackageDllExists Condition="Exists('$(AdvancedDataGridLibPath)RpaWinUiComponents.AdvancedWinUiDataGrid.dll')">true</PackageDllExists>
      <PackagePdbExists Condition="Exists('$(AdvancedDataGridLibPath)RpaWinUiComponents.AdvancedWinUiDataGrid.pdb')">true</PackagePdbExists>
    </PropertyGroup>

    <Message Text="✅ Using lib path: $(AdvancedDataGridLibPath)" Importance="normal" />

    <Message Text="✅ Package DLL found: $(AdvancedDataGridLibPath)RpaWinUiComponents.AdvancedWinUiDataGrid.dll"
             Importance="normal"
             Condition="'$(PackageDllExists)' == 'true'" />

    <Message Text="✅ Package PDB found: $(AdvancedDataGridLibPath)RpaWinUiComponents.AdvancedWinUiDataGrid.pdb"
             Importance="normal"
             Condition="'$(PackagePdbExists)' == 'true'" />

    <!-- ✅ OPRAVENÉ: Warning iba ak DLL skutočne neexistuje -->
    <Warning Text="⚠️ AdvancedWinUiDataGrid: DLL not found at $(AdvancedDataGridLibPath). Package installation may be incomplete."
             Condition="'$(PackageDllExists)' != 'true'" />

    <!-- ✅ Informácia o možných riešeniach -->
    <Message Text="💡 TIP: Skús: dotnet restore --force alebo vymaž bin/obj a rebuild"
             Importance="high"
             Condition="'$(PackageDllExists)' != 'true'" />
  </Target>

  <!-- ✅ NOVÉ: Auto-fix pokus - pokúsi sa obnoviť package ak nie je nájdený -->
  <Target Name="AutoRestoreAdvancedDataGridPackage"
          BeforeTargets="Build"
          Condition="'$(PackageDllExists)' != 'true' AND '$(UseWinUI)' == 'true' AND '$(Configuration)' == 'Debug'">

    <Message Text="🔄 Attempting auto-restore of AdvancedWinUiDataGrid package..." Importance="high" />

    <Exec Command="dotnet restore --force-evaluate"
          WorkingDirectory="$(MSBuildProjectDirectory)"
          ContinueOnError="true"
          IgnoreExitCode="true" />
  </Target>

  <!-- ✅ NOVÉ: Support pre rôzne build platformy -->
  <PropertyGroup Condition="'$(UseWinUI)' == 'true'">
    <!-- Zabezpečiť že máme správne platform targets -->
    <ResolveAssemblyWarnOrErrorOnTargetArchitectureMismatch>None</ResolveAssemblyWarnOrErrorOnTargetArchitectureMismatch>
  </PropertyGroup>

</Project>